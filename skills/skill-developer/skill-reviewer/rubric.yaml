persona: skill-developer
skill: skill-reviewer

criteria:
  structural:
    - id: obtains-skill
      description: Agent asks for the skill content and identifies the persona
      check: Agent asks for or confirms the SKILL.md content and which persona it belongs to before beginning the review

    - id: reviews-format
      description: Agent checks format compliance (frontmatter, structure, step quality)
      check: Agent evaluates at least two format elements (frontmatter fields, step structure, agent addressing, description quality)

    - id: reviews-persona-alignment
      description: Agent evaluates whether the skill respects its persona's constraints
      check: Agent explicitly assesses whether the skill's instructions comply with the persona's pedagogical objective and constraints

    - id: reviews-pedagogical-quality
      description: Agent evaluates the skill as a pedagogical design
      check: Agent assesses at least two pedagogical dimensions (learning sequence, active learning, specificity, concrete outputs, pitfall handling)

    - id: produces-structured-review
      description: Output follows the structured review format with distinct sections
      check: Review contains at least a summary and two of the four sections (format, persona alignment, pedagogy, agent-readiness)

  pedagogical:
    - id: constructive-tone
      description: Agent names what works well before identifying problems
      weight: high

    - id: specific-improvements
      description: Every critique comes with a concrete suggestion for how to fix it
      weight: high

    - id: distinguishes-severity
      description: Agent separates must-fix issues from nice-to-have improvements
      weight: medium

    - id: holistic-assessment
      description: Review considers multiple dimensions (format, persona, pedagogy, agent-readiness), not just one
      weight: medium

anti_patterns:
  - id: vague-feedback
    description: Agent gives feedback like "needs improvement" without specifics
    check: Agent's critique consists of general statements without citing specific passages or suggesting concrete fixes

  - id: format-only-review
    description: Agent only checks format compliance without evaluating pedagogy or persona alignment
    check: Review addresses only frontmatter and structure while ignoring pedagogical quality or persona constraints

  - id: rewrites-without-asking
    description: Agent rewrites the skill without the user's permission
    check: Agent produces a full revised SKILL.md without first presenting the review and asking whether revision is wanted

test_scenarios:
  - id: happy-path-good-skill
    setup: >
      User submits a well-written student skill with minor issues --
      good structure but a slightly vague step and a description that
      could be more specific.
    messages:
      - role: user
        content: "Can you review this skill for me? It's a student skill for legal writing feedback."
      - role: user
        content: |
          ---
          name: writing-feedback
          description: Helps with legal writing
          metadata:
            version: 0.1.0
          ---
          # Legal Writing Feedback
          You help law students improve their legal writing.
          ## Tone
          Encouraging and constructive.
          ## Step 1: Read the Draft
          Read the student's draft carefully.
          ## Step 2: Give Feedback
          Help the student improve their writing by giving feedback on structure, analysis, and clarity.
          ## Step 3: Suggest Next Steps
          Suggest what the student should work on next.
    expected:
      - Acknowledges the basic structure is correct before identifying issues
      - Flags the description as too vague to trigger reliably
      - Notes that Steps 2 and 3 lack specificity (what kind of feedback? how?)
      - Checks persona compliance (student persona -- does it avoid producing work product?)
      - Provides specific suggestions for each issue, not just "make it better"

  - id: persona-violation
    setup: >
      User submits a skill that subtly violates its persona's constraints.
    messages:
      - role: user
        content: "Review this pro-se skill I wrote."
      - role: user
        content: |
          ---
          name: court-form-helper
          description: Helps self-represented people fill out court forms correctly.
          metadata:
            version: 0.1.0
          ---
          # Court Form Helper
          You help pro-se litigants complete court forms.
          ## Step 1: Identify the Form
          Ask what form they need to fill out.
          ## Step 2: Fill in the Fields
          Guide them through each field, explaining what information goes where. For legal arguments sections, suggest what to write based on their situation.
          ## Step 3: Review
          Review the completed form for accuracy and completeness.
    expected:
      - Identifies that Step 2's "suggest what to write based on their situation" potentially constitutes legal advice
      - Flags this as a must-fix persona violation for the pro-se persona
      - Distinguishes this from minor format issues
      - Suggests a revision that helps the person understand what each field asks without advising what to write

  - id: minimal-input
    setup: >
      User asks for a review without providing the skill.
    messages:
      - role: user
        content: "Can you review my skill?"
    expected:
      - Asks the user to provide the SKILL.md content
      - Asks which persona it belongs to
      - Does not attempt a review without the actual content
